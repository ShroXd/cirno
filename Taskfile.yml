version: "3"

tasks:
  # ---------------------------- âš™ï¸ Install dependencies âš™ï¸ ----------------------------

  install:
    desc: "ğŸ“¦ Install dependencies for both front-end and back-end"
    deps:
      - install:web
      - install:backend

  install:web:
    desc: "ğŸ“¦ Install front-end dependencies"
    dir: web
    cmds:
      - pnpm install

  install:backend:
    desc: "ğŸ“¦ Install back-end dependencies"
    dir: backend
    cmds:
      - cargo fetch

  # ---------------------------- ğŸ§ª Run Tests ğŸ§ª ----------------------------

  test:
    desc: "ğŸ§ª Run tests for both front-end and back-end"
    deps:
      - test:web
      - test:backend

  test:web:
    desc: "ğŸ§ª Run front-end tests"
    dir: web
    cmds:
      - pnpm test

  test:backend:
    desc: "ğŸ§ª Run back-end tests"
    dir: backend
    cmds:
      - cargo test

  # ---------------------------- ğŸ› ï¸ Development Mode ğŸ› ï¸ ----------------------------

  dev:
    desc: "ğŸš€ Run development servers for both front-end and back-end"
    deps:
      - dev:web
      - dev:backend

  dev:web:
    desc: "ğŸš€ Run front-end development server"
    dir: web
    cmds:
      - pnpm run dev

  dev:backend:
    desc: "ğŸš€ Run back-end development server"
    dir: backend
    cmds:
      - cargo run

  # ---------------------------- ğŸ“¦ Build for Production ğŸ“¦ ----------------------------

  build:
    desc: "ğŸ—ï¸ Build both front-end and back-end for production"
    deps:
      - build:web
      - build:backend

  build:web:
    desc: "ğŸ—ï¸ Build front-end for production"
    dir: web
    cmds:
      - pnpm run build

  build:backend:
    desc: "ğŸ—ï¸ Build back-end for production"
    dir: backend
    cmds:
      - cargo build --release

  # ---------------------------- ğŸ§¹ Clean Build Artifacts ğŸ§¹ ----------------------------

  clean:
    desc: "ğŸ§¹ Clean dist, target, and tsbuildinfo files"
    deps:
      - clean:web
      - clean:backend

  clean:web:
    desc: "ğŸ§¹ Clean front-end dist and tsbuildinfo files"
    dir: web
    cmds:
      - rm -rf dist
      - rm -f tsconfig.app.tsbuildinfo
      - rm -f tsconfig.node.tsbuildinfo

  clean:backend:
    desc: "ğŸ§¹ Clean back-end target directory"
    dir: backend
    cmds:
      - rm -rf target
